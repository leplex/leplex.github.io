---
title: 测试就是开发,开发就是测试
date: 2021-08-13 14:30:11
tags: system design
category: 思考
---
<img src='/image/testRule1.jpg'></img>
工作多年, 说起测试, 人人都说**测试真的很重要**, 但真正把测试落到实地的, 却是很少的, 这是为什么呢？我尝试来刨根问底一下。

## 曾经的困难
说起测试, 教科书说里一般就是一个计算函数,然后我们去写单元测试去测试它, 例如:
```
加法计算
func sum(i int, j int)int{
    return i + j
}
```
测起来也很容易, 在单元测试里调用这个函数, 补点用例就可以了。
但实际情况呢, 特别是我做的etl服务, 需要调用API, 缓存服务,数据库等等组件, 真正的纯计算其实没有多少。由于调用的组件很多, 在测单元测试时, 需要Mock很多数据, 例如某个逻辑读了redis, 就需要mock读redis, 写起来比开发时间还多的多, 测试代码也很复杂。 由此我还曾经得出结论：I/O类的服务不太适合写单测。 但是, 没有单测, 没有低成本的测试, bug只能发现一个处理一个, 由于没有回归测试, 有些问题还容易反复出现。
<img src='/image/testRule2.webp' width='30%' height='30%'></img>
随后便开始了自己的学习之路,找文章、找课程,来寻求问题的解决方案。

## 良好的架构设计是工程质量的第一道屏障
我们对架构/代码设计的追求, 无非就是六个字：高内聚、低耦合。
当架构设计的合理且简单时, 测试成本也相对较低, bug发生的概率也会随之降低。
这里之所以提出这个观点, 是希望表达：对于系统的质量, 架构设计的质量应该放在第一位！第一位！第一位！当系统的质量问题频繁发生时, 我们首先应该反思的是, 我们的架构设计是否合格。
而不是：
1. 再多雇QA同事
2. 测试时间不够
3. 甩锅QA

## 测试金字塔
<img src='/image/testRule3.jpg'></img>
从图中看出, 单元测试的成本是最低的。其实也不难理解, 集成测试则要把好几个单元组装到一起才能测试, 单元测试的关注点只有一个单元。
所以我们的努力目标就是, 把bug消灭在单元测试里, 越早发现问题, 成本越低。不能说有了QA同学做集成测试了, 就万事大吉了, 就可以对质量不负责了。

## 真的需要QA吗？
转载耗子叔的文章 <a src='https://coolshell.cn/articles/6994.html'>我们需要专职的QA吗？</a>

## 道理都懂, 为什么做不好
<img src='/image/testRule4.jpg' width='30%' height='30%'></img>
对于这个问题思考了蛮久, 根据自己有限的经验, 也是对自己的批判, 尝试说几个点。

- 认为测试是技术含量低的工作。不愿意做, 某种程度上觉的浪费时间。
- 系统设计的不好, 测试成本高。也导致写测试很痛苦, 所以不想写测试, 存在侥幸心理。
- 片面地追求结果导向, 追求开发速度。这也是老生常谈了, 懂得都懂。
- 为了完成测试任务而测试。搞**测试**的形式主义, 掩耳盗铃。

### 自己的经验
- 改善自己的代码质量, 在写的时候就需要去思考怎么测试。
- 写代码过称中的debug过程, 顺手被固化成单元测试代码, 代码写完了, 基本的单元测试也写完了。
- 后来发现的bug, 要补充到单元测试里。
- 测试代码要足够的简单, 即测试代码不构成高的维护成本。

哈哈, 没什么高大上的东西, 但是最主要的是, 每次提交代码前跑所有的单测, 看着批量的用例pass, 心里是很爽的, 这也提升了我写测试的快乐。


## 小小的总结
1. 测试是软件开发重要的组成部分,测试应该是软件开发团队中所有人的事,而不仅仅是测试人员的事。因为软件变更成本会随着时间和开发阶段逐步增加,能在早期解决的问题,就不要将它延后至下一个阶段。
2. 写测试应该是程序员工作完成的重要组成部分。
3. 越底层的测试应该写得越多。
4. 找到写测试的快乐。

参考：
1. https://time.geekbang.org/column/article/77917
2. https://coolshell.cn/articles/6994.html


