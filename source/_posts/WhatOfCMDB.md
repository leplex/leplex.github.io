---
title: 我对cmdb的宏观理解
date: 2021-08-11 17:55:14
tags: cmdb
---

## 什么是cmdb
来看一下wiki的定义：

配置管理数据库（configuration management database）简称CMDB,是信息技术基础架构库（ITIL）用语,是组织用来储存软件硬件资产（常称为形态项目,CI）资讯的数据库。配置管理数据库可以将形态项目拆解到对应的逻辑层[1]。数据库类似组织的资料仓储,也会记录各资产之间关系的资讯[2]。CMDB提供方式可以了解组织的关键资产以及彼此之间的关系,例如信息系统、upstream来源以及资产之间的相依性、以及资产的downstream目标[3]。


非常的抽象哈,举个例子：
<img src="/image/cmdb.png" width="50%" height="50%">
如图, 我们的运维资源之间有着各种各样的关系,是一个图,而cmdb,管理的就是这样的一个图模型,提供这张图的增删改查。
那么这样的数据有什么作用呢？
1. 报警优化, 例如部署mongodb的机器出现了故障,就可以根据cmdb数据迅速计算出影响范围。
2. 配置管理。 上层业务开发者,可以根据cmdb的数据生成自己的配置。
3. 其他(应用场景还是很广泛的,我主要的工作还是在cmdb及其数据本身的建设,所以具体怎么用这些数据,了解的不是太深)

## cmdb的架构
<img src="/image/cmdb_infra.png" width="50%" height="50%">

- cmdb层用来约束数据的输入输出,规定数据的写入和查询必须符合业务建模。例如机器能和服务可以建立关系,但是跟机房没有直接关系(实际建模关系是机器-机架-机房)
- etl。etl是录入cmdb数据的服务总称,需要收集各方数据写入到cmdb
- 查询。查询指数据消费端

### cmdb层
cmdb规范数据输入输出,管理业务建模元数据,为上游服务提供增删改查的接口。

元数据：

- ci. 描述实体的元数据。例如机器,规定了机器数据有唯一表示,ip、cpu核数、内存大小等
- rs. 描述实体间关系的元数据。例如,规定机器和ipv4有1:n的关系

当etl写入数据时,cmdb通过ci、rs的定义,检查输入是否合法。读数据,当然也按照元数据规定的格式读取数据。

### etl
我主要负责就是etl的开发, 从功能上来讲无非就是去收集兄弟部门或者agent采集的数据然后录入到cmdb,但是easy to say, hard to do. 遇见了无数的坑,本篇文章就不细说了。
<img src='https://img2.baidu.com/it/u=2946701841,1025414129&fm=26&fmt=auto&gp=0.jpg' width="30%" height="30%"></img>
有兴趣前往<a src='www.baidu.com'>cmdb etl与数据质量</a>


总结: 基础的idea就是这么简单,cmdb无非就是一个数据中心,给到各方去消费, 但是数据质量是最难保证,数据会不及时,不正确,不一致。这都会极大影响用户体验。


