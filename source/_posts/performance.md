---
title: 不要过早地考虑性能问题
date: 2021-08-15 16:42:50
tags: system design
category: 思考
---
先引用一下名人名言, 自己总结出的东西, 去google一下, 原来前人们早就想到了。
```
Premature optimization is the root of all evil ----- Donald Knuth
```

聊一个自己遇到过的沟通场景:
```
小明: 新的设计方案更加合理, 将通用性的功能下沉到A模块, 其他模块间也解耦了。
小亮: 看起来是这样的, 但如此这样, A模块会有性能问题啊！所以不能采用这样的方案
小明: ......
```
这里A模块真的有性能问题吗？ 小亮的判断依据大概就是A模块是加了一点计算逻辑, 所以便推测很可能有性能问题。这样的推测不能说没有道理, 也很可能是对的。

但是问题出在哪里呢？
## 性能问题未必真的存在
很多时候, 性能问题是想象出来的, 刚开始时, 一顿操作猛如虎, 设计了各种机制优化性能, 最后发现跟最朴素的写法性能测试上没区别。
比如某个服务的大部性能消耗是在数据库查询上, 某个同学要优化网络传输, 使用了自认先进的grpc框架。然后呢？性能测试下来跟朴素的http几乎一样, 还白白花了相对更多的时间。
ps: 这个例子不表明使用grpc就有问题, 对于性能问题不能靠想象。

## 性能问题尽量在局部解决
说回上文提到的场景, 假如即便真的有性能问题, 其实也可以在A模块内部进行解决, 借此架构调整的机会, 反而提高了底层模块的能力。其实性能问题如果存在, 总要在一个地方进行解决。不是在A解决, 那么A的调用方就需要想办法解决。
这里提一个我3年前遇到的场景:
A同学的部门为我们提高数据查询服务
```
me: 你们这个查询接口的性能不太行啊, 请求量也不大(其实是翻页翻到后边, 他们的数据库会抗不住)
A: 你们查询为什么要翻那么大的页？
me: 我们查询一个时间段所有的数据啊。
A: 你们可以实时一直请求, 第一步：先请求这个接口, 然后再...最后...。 然后存到自己的系统里, 就不用翻那么大页了。
me: ......(无语)
```
这里的问题就比较典型, 其实A同学可以进一步优化自己的系统, 解决查询翻页性能崩溃的问题, 但是他却选择了让他的用户去承担。所以后来我们自己做了一套系统来存储数据, 只从他们那里简单的同步数据, 不再调用他们的接口。但重复造了一遍轮子, 实在是时间与金钱的浪费。

## 总结
1. 架构的合理性, 尽量不要为性能问题让步, 尽量将性能问题在模块内解决而不是扩散出去。
2. 一开始想象出来的性能问题, 未必真的存在,。
3. 解决性能问题, 要找到真正的瓶颈去优化, 优化非关键因素浪费表情。
